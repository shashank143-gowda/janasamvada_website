{% extends 'base.html' %}

{% block title %}Hazards Reporting - JanSamvaad{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<style>
    .hazard-header {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        padding: 60px 0;
        border-radius: 0 0 50px 50px;
        margin-bottom: 40px;
        position: relative;
        overflow: hidden;
    }
    
    .hazard-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url('/static/img/hazard-pattern.png');
        background-size: cover;
        opacity: 0.1;
        z-index: 0;
    }
    
    .hazard-header .container {
        position: relative;
        z-index: 1;
    }
    
    .hazard-card {
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 10px 25px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        height: 100%;
        border: none;
        background-color: #fff;
        position: relative;
    }
    
    .hazard-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    }
    
    .hazard-card .card-img-top {
        height: 200px;
        object-fit: cover;
        transition: all 0.5s ease;
    }
    
    .hazard-card:hover .card-img-top {
        transform: scale(1.05);
    }
    
    .hazard-card .card-body {
        padding: 1.5rem;
        position: relative;
    }
    
    .hazard-card .card-title {
        font-weight: 700;
        margin-bottom: 0.75rem;
        color: #2c3e50;
        font-size: 1.2rem;
        line-height: 1.4;
    }
    
    .hazard-card .card-text {
        color: #555;
        font-size: 0.95rem;
        margin-bottom: 1.25rem;
        line-height: 1.6;
    }
    
    .hazard-card .image-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 200px;
        background: linear-gradient(to bottom, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.7) 100%);
        opacity: 0.8;
        transition: all 0.3s ease;
    }
    
    .hazard-card:hover .image-overlay {
        opacity: 0.6;
    }
    
    .hazard-type {
        position: absolute;
        top: 15px;
        right: 15px;
        padding: 6px 14px;
        border-radius: 30px;
        font-size: 0.8rem;
        font-weight: 600;
        z-index: 10;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .hazard-status {
        position: absolute;
        top: 15px;
        left: 15px;
        padding: 6px 14px;
        border-radius: 30px;
        font-size: 0.8rem;
        font-weight: 600;
        z-index: 10;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .status-pending {
        background-color: #f39c12;
        color: white;
    }
    
    .status-in-progress {
        background-color: #3498db;
        color: white;
    }
    
    .status-resolved {
        background-color: #2ecc71;
        color: white;
    }
    
    .type-road {
        background-color: #9b59b6;
        color: white;
    }
    
    .type-water {
        background-color: #3498db;
        color: white;
    }
    
    .type-electricity {
        background-color: #f1c40f;
        color: white;
    }
    
    .type-other {
        background-color: #95a5a6;
        color: white;
    }
    
    .upvote-btn {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 30px;
        padding: 8px 16px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        color: #555;
        font-weight: 600;
    }
    
    .upvote-btn:hover, .upvote-btn.active {
        background-color: #e74c3c;
        color: white;
        border-color: #e74c3c;
        transform: translateY(-2px);
    }
    
    .upvote-btn i {
        font-size: 0.9rem;
    }
    
    .avatar-circle {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        font-weight: 600;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .location-badge {
        display: inline-flex;
        align-items: center;
        background-color: #f8f9fa;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        color: #555;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .location-badge i {
        margin-right: 5px;
        color: #e74c3c;
    }
    
    .report-btn {
        border-radius: 30px;
        padding: 14px 32px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        border: none;
        color: white;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
    }
    
    .report-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
    }
    
    .report-btn i {
        margin-right: 8px;
    }
    
    .filter-card {
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        margin-bottom: 30px;
        border: none;
        background-color: #fff;
    }
    
    .filter-card .card-header {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        border: none;
        padding: 15px 20px;
    }
    
    .filter-btn {
        background-color: #e74c3c;
        border: none;
        border-radius: 30px;
        transition: all 0.3s ease;
        padding: 10px 20px;
        font-weight: 600;
        box-shadow: 0 3px 10px rgba(231, 76, 60, 0.2);
    }
    
    .filter-btn:hover {
        background-color: #c0392b;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
    }
    
    .map-container {
        height: 450px;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }
    
    .voice-report-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 65px;
        height: 65px;
        border-radius: 50%;
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: 0 5px 20px rgba(231, 76, 60, 0.4);
        z-index: 1000;
        transition: all 0.3s ease;
    }
    
    .voice-report-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(231, 76, 60, 0.5);
    }
    
    .voice-report-btn.recording {
        animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7);
        }
        70% {
            box-shadow: 0 0 0 20px rgba(231, 76, 60, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
        }
    }
    
    .voice-report-modal .modal-content {
        border-radius: 16px;
        overflow: hidden;
        border: none;
    }
    
    .voice-report-modal .modal-header {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        border: none;
    }
    
    .voice-report-modal .modal-footer {
        border: none;
    }
    
    .voice-visualizer {
        height: 120px;
        width: 100%;
        background-color: #f8f9fa;
        border-radius: 12px;
        overflow: hidden;
        position: relative;
    }
    
    .voice-visualizer-bars {
        display: flex;
        align-items: flex-end;
        height: 100%;
        padding: 0 10px;
    }
    
    .visualizer-bar {
        background-color: #e74c3c;
        width: 6px;
        margin: 0 3px;
        border-radius: 6px 6px 0 0;
        transition: height 0.1s ease;
    }
    
    .language-toggle {
        position: fixed;
        top: 100px;
        right: 20px;
        z-index: 1000;
        background-color: white;
        border-radius: 30px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        padding: 8px;
        display: flex;
        flex-direction: column;
    }
    
    .language-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 5px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .language-btn.active {
        background-color: #e74c3c;
        color: white;
        box-shadow: 0 3px 10px rgba(231, 76, 60, 0.3);
    }
    
    .language-btn:not(.active) {
        background-color: #f8f9fa;
        color: #333;
    }
    
    .language-btn:hover:not(.active) {
        background-color: #e0e0e0;
        transform: translateY(-2px);
    }
    
    .hazard-meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 15px;
    }
    
    .hazard-user {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .hazard-user-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .hazard-date {
        font-size: 0.8rem;
        color: #7f8c8d;
    }
    
    .hazard-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #f1f1f1;
    }
    
    .hazard-actions {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .action-btn {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 30px;
        padding: 6px 12px;
        font-size: 0.85rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 5px;
        color: #555;
    }
    
    .action-btn:hover {
        background-color: #e0e0e0;
        transform: translateY(-2px);
    }
    
    .action-btn i {
        font-size: 0.8rem;
    }
    
    .hazard-priority {
        position: absolute;
        top: 50px;
        right: 15px;
        padding: 6px 14px;
        border-radius: 30px;
        font-size: 0.8rem;
        font-weight: 600;
        z-index: 10;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        background-color: #e67e22;
        color: white;
    }
    
    .priority-high {
        background-color: #e74c3c;
    }
    
    .priority-medium {
        background-color: #e67e22;
    }
    
    .priority-low {
        background-color: #3498db;
    }
    
    .hazard-card .progress {
        height: 8px;
        border-radius: 4px;
        margin-top: 15px;
    }
    
    .hazard-card .progress-bar {
        background-color: #2ecc71;
    }
    
    .hazard-stats {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-top: 15px;
    }
    
    .stat-item {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.85rem;
        color: #7f8c8d;
    }
    
    .stat-item i {
        color: #e74c3c;
    }
    
    .hazard-card .card-img-overlay {
        top: auto;
        height: 60px;
        background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
        display: flex;
        align-items: flex-end;
        padding: 10px 15px;
    }
    
    .hazard-card .card-img-overlay .location-badge {
        background-color: rgba(255,255,255,0.2);
        color: white;
        border: none;
        box-shadow: none;
    }
    
    .section-title {
        position: relative;
        margin-bottom: 30px;
        padding-bottom: 15px;
    }
    
    .section-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 3px;
        background-color: #e74c3c;
    }
    
    .pagination-container {
        display: flex;
        justify-content: center;
        margin-top: 40px;
    }
    
    .pagination .page-item .page-link {
        border-radius: 30px;
        margin: 0 5px;
        color: #e74c3c;
        border: 1px solid #e9ecef;
        transition: all 0.3s ease;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #e74c3c;
        border-color: #e74c3c;
    }
    
    .pagination .page-item .page-link:hover {
        background-color: #f8f9fa;
        transform: translateY(-2px);
    }
    
    .pagination .page-item.active .page-link:hover {
        background-color: #e74c3c;
    }
    
    .no-results {
        text-align: center;
        padding: 40px 0;
    }
    
    .no-results i {
        font-size: 3rem;
        color: #e0e0e0;
        margin-bottom: 20px;
    }
    
    .no-results h4 {
        color: #7f8c8d;
        margin-bottom: 10px;
    }
    
    .no-results p {
        color: #95a5a6;
        max-width: 500px;
        margin: 0 auto;
    }
</style>
{% endblock %}

{% block content %}
<!-- Language Toggle -->
<div class="language-toggle">
    <button class="language-btn active" data-lang="en" title="English">EN</button>
    <button class="language-btn" data-lang="kn" title="ಕನ್ನಡ">ಕ</button>
    <button class="language-btn" data-lang="hi" title="हिंदी">हि</button>
</div>

<!-- Voice Report Button -->
<button class="voice-report-btn" id="voiceReportBtn" title="Report hazard using voice">
    <i class="fas fa-microphone"></i>
</button>

<!-- Header Section -->
<section class="hazard-header">
    <div class="container text-center">
        <h1 class="display-4 fw-bold mb-3 animate__animated animate__fadeInDown" data-translate="hazards-title">Hazards Reporting</h1>
        <p class="lead mb-4 animate__animated animate__fadeInUp" data-translate="hazards-subtitle">Report and track hazards in your community to ensure quick resolution</p>
        <div class="d-flex justify-content-center">
            <a href="{{ url_for('hazards_bp.report_hazard_page') }}" class="btn report-btn animate__animated animate__fadeInUp">
                <i class="fas fa-exclamation-triangle"></i> <span data-translate="report-hazard">Report a Hazard</span>
            </a>
        </div>
    </div>
</section>

<div class="container">
    <div class="row">
        <!-- Filters Section -->
        <div class="col-lg-3 mb-4">
            <div class="filter-card sticky-top" style="top: 100px;" data-aos="fade-right">
                <div class="card-header">
                    <h5 class="mb-0" data-translate="filter-hazards">Filter Hazards</h5>
                </div>
                <div class="card-body">
                    <form id="filter-form">
                        <div class="mb-3">
                            <label for="hazard-type" class="form-label" data-translate="hazard-type">Hazard Type</label>
                            <select class="form-select" id="hazard-type">
                                <option value="" data-translate="all-types">All Types</option>
                                <option value="road" data-translate="road">Road</option>
                                <option value="water" data-translate="water">Water</option>
                                <option value="electricity" data-translate="electricity">Electricity</option>
                                <option value="other" data-translate="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="hazard-status" class="form-label" data-translate="status">Status</label>
                            <select class="form-select" id="hazard-status">
                                <option value="" data-translate="all-statuses">All Statuses</option>
                                <option value="pending" data-translate="pending">Pending</option>
                                <option value="in-progress" data-translate="in-progress">In Progress</option>
                                <option value="resolved" data-translate="resolved">Resolved</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="hazard-priority" class="form-label" data-translate="priority">Priority</label>
                            <select class="form-select" id="hazard-priority">
                                <option value="" data-translate="all-priorities">All Priorities</option>
                                <option value="high" data-translate="high">High</option>
                                <option value="medium" data-translate="medium">Medium</option>
                                <option value="low" data-translate="low">Low</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="location-filter" class="form-label" data-translate="location">Location</label>
                            <input type="text" class="form-control" id="location-filter" placeholder="Enter location">
                        </div>
                        <div class="mb-3">
                            <label for="date-range" class="form-label" data-translate="date-range">Date Range</label>
                            <select class="form-select" id="date-range">
                                <option value="all" data-translate="all-time">All Time</option>
                                <option value="today" data-translate="today">Today</option>
                                <option value="week" data-translate="this-week">This Week</option>
                                <option value="month" data-translate="this-month">This Month</option>
                            </select>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn filter-btn" data-translate="apply-filters">Apply Filters</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Statistics Card -->
            <div class="filter-card" data-aos="fade-right" data-aos-delay="100">
                <div class="card-header">
                    <h5 class="mb-0" data-translate="statistics">Statistics</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-3">
                        <span data-translate="total-hazards">Total Hazards</span>
                        <span class="fw-bold" id="total-hazards">124</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span data-translate="pending">Pending</span>
                        <span class="fw-bold text-warning" id="pending-hazards">45</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span data-translate="in-progress">In Progress</span>
                        <span class="fw-bold text-primary" id="in-progress-hazards">32</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span data-translate="resolved">Resolved</span>
                        <span class="fw-bold text-success" id="resolved-hazards">47</span>
                    </div>
                    <div class="progress mt-3">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: 36%" aria-valuenow="36" aria-valuemin="0" aria-valuemax="100"></div>
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 26%" aria-valuenow="26" aria-valuemin="0" aria-valuemax="100"></div>
                        <div class="progress-bar bg-success" role="progressbar" style="width: 38%" aria-valuenow="38" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
            
            <!-- News Section -->
            <div class="filter-card" data-aos="fade-right" data-aos-delay="200">
                <div class="card-header">
                    <h5 class="mb-0" data-translate="local-news">Local News</h5>
                </div>
                <div class="card-body">
                    <div class="news-item mb-3 pb-3 border-bottom">
                        <h6 class="mb-1">Road Repair Initiative Launched</h6>
                        <p class="small text-muted mb-0">Government allocates ₹2 crore for road repairs in rural areas.</p>
                        <small class="text-muted">2 hours ago</small>
                    </div>
                    <div class="news-item mb-3 pb-3 border-bottom">
                        <h6 class="mb-1">Water Supply Restoration</h6>
                        <p class="small text-muted mb-0">Water supply to be restored in affected areas by tomorrow.</p>
                        <small class="text-muted">5 hours ago</small>
                    </div>
                    <div class="news-item">
                        <h6 class="mb-1">Power Grid Upgrade</h6>
                        <p class="small text-muted mb-0">New power grid infrastructure to reduce outages.</p>
                        <small class="text-muted">1 day ago</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content Section -->
        <div class="col-lg-9">
            <!-- Map Section -->
            <div class="mb-4" data-aos="fade-up">
                <h3 class="section-title" data-translate="hazards-map">Hazards Map</h3>
                <div class="map-container" id="hazards-map"></div>
            </div>
            
            <!-- Hazards List Section -->
            <div data-aos="fade-up">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="section-title mb-0" data-translate="recent-hazards">Recent Hazards</h3>
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-sort me-1"></i> <span data-translate="sort-by">Sort By</span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                            <li><a class="dropdown-item active" href="#" data-sort="recent" data-translate="most-recent">Most Recent</a></li>
                            <li><a class="dropdown-item" href="#" data-sort="upvotes" data-translate="most-upvotes">Most Upvotes</a></li>
                            <li><a class="dropdown-item" href="#" data-sort="priority" data-translate="priority">Priority</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="row g-4" id="hazards-container">
                    <!-- Hazard Card 1 -->
                    <div class="col-md-6 mb-4">
                        <div class="hazard-card">
                            <div class="position-relative">
                                <img src="/static/img/hazards/pothole.jpg" class="card-img-top" alt="Pothole on Main Road">
                                <div class="image-overlay"></div>
                                <span class="hazard-status status-pending" data-translate="pending">Pending</span>
                                <span class="hazard-type type-road" data-translate="road">Road</span>
                                <span class="hazard-priority priority-high">High Priority</span>
                                <div class="card-img-overlay">
                                    <span class="location-badge">
                                        <i class="fas fa-map-marker-alt"></i> Jayanagar, Bengaluru
                                    </span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="hazard-meta">
                                    <div class="hazard-user">
                                        <div class="avatar-circle bg-primary text-white">RK</div>
                                        <div>
                                            <div class="hazard-user-name">Rahul Kumar</div>
                                            <div class="hazard-date">Reported on May 15, 2023</div>
                                        </div>
                                    </div>
                                </div>
                                <h5 class="card-title">Large Pothole on Main Road</h5>
                                <p class="card-text">Deep pothole causing traffic congestion and damage to vehicles. Multiple accidents reported in the past week.</p>
                                
                                <div class="hazard-stats">
                                    <div class="stat-item">
                                        <i class="fas fa-eye"></i> 245 views
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-comment"></i> 18 comments
                                    </div>
                                </div>
                                
                                <div class="hazard-footer">
                                    <button class="upvote-btn">
                                        <i class="fas fa-arrow-up"></i> 32 Upvotes
                                    </button>
                                    <div class="hazard-actions">
                                        <button class="action-btn">
                                            <i class="fas fa-comment"></i> Comment
                                        </button>
                                        <button class="action-btn">
                                            <i class="fas fa-share-alt"></i> Share
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hazard Card 2 -->
                    <div class="col-md-6 mb-4">
                        <div class="hazard-card">
                            <div class="position-relative">
                                <img src="/static/img/hazards/water-leak.jpg" class="card-img-top" alt="Water Pipeline Leakage">
                                <div class="image-overlay"></div>
                                <span class="hazard-status status-in-progress" data-translate="in-progress">In Progress</span>
                                <span class="hazard-type type-water" data-translate="water">Water</span>
                                <span class="hazard-priority priority-medium">Medium Priority</span>
                                <div class="card-img-overlay">
                                    <span class="location-badge">
                                        <i class="fas fa-map-marker-alt"></i> Koramangala, Bengaluru
                                    </span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="hazard-meta">
                                    <div class="hazard-user">
                                        <div class="avatar-circle bg-success text-white">SP</div>
                                        <div>
                                            <div class="hazard-user-name">Sneha Patel</div>
                                            <div class="hazard-date">Reported on May 12, 2023</div>
                                        </div>
                                    </div>
                                </div>
                                <h5 class="card-title">Water Pipeline Leakage</h5>
                                <p class="card-text">Major water pipeline leakage causing water wastage and road damage. Area becoming slippery and dangerous.</p>
                                
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="small text-muted text-end mt-1">65% Complete</div>
                                
                                <div class="hazard-stats">
                                    <div class="stat-item">
                                        <i class="fas fa-eye"></i> 178 views
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-comment"></i> 12 comments
                                    </div>
                                </div>
                                
                                <div class="hazard-footer">
                                    <button class="upvote-btn">
                                        <i class="fas fa-arrow-up"></i> 24 Upvotes
                                    </button>
                                    <div class="hazard-actions">
                                        <button class="action-btn">
                                            <i class="fas fa-comment"></i> Comment
                                        </button>
                                        <button class="action-btn">
                                            <i class="fas fa-share-alt"></i> Share
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hazard Card 3 -->
                    <div class="col-md-6 mb-4">
                        <div class="hazard-card">
                            <div class="position-relative">
                                <img src="/static/img/hazards/power-line.jpg" class="card-img-top" alt="Fallen Power Line">
                                <div class="image-overlay"></div>
                                <span class="hazard-status status-resolved" data-translate="resolved">Resolved</span>
                                <span class="hazard-type type-electricity" data-translate="electricity">Electricity</span>
                                <span class="hazard-priority priority-high">High Priority</span>
                                <div class="card-img-overlay">
                                    <span class="location-badge">
                                        <i class="fas fa-map-marker-alt"></i> Indiranagar, Bengaluru
                                    </span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="hazard-meta">
                                    <div class="hazard-user">
                                        <div class="avatar-circle bg-warning text-white">AJ</div>
                                        <div>
                                            <div class="hazard-user-name">Amit Joshi</div>
                                            <div class="hazard-date">Reported on May 10, 2023</div>
                                        </div>
                                    </div>
                                </div>
                                <h5 class="card-title">Fallen Power Line</h5>
                                <p class="card-text">Power line fell due to heavy winds. Caused power outage in the area and posed significant safety risk.</p>
                                
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="small text-muted text-end mt-1">Resolved on May 11, 2023</div>
                                
                                <div class="hazard-stats">
                                    <div class="stat-item">
                                        <i class="fas fa-eye"></i> 312 views
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-comment"></i> 27 comments
                                    </div>
                                </div>
                                
                                <div class="hazard-footer">
                                    <button class="upvote-btn">
                                        <i class="fas fa-arrow-up"></i> 45 Upvotes
                                    </button>
                                    <div class="hazard-actions">
                                        <button class="action-btn">
                                            <i class="fas fa-comment"></i> Comment
                                        </button>
                                        <button class="action-btn">
                                            <i class="fas fa-share-alt"></i> Share
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hazard Card 4 -->
                    <div class="col-md-6 mb-4">
                        <div class="hazard-card">
                            <div class="position-relative">
                                <img src="/static/img/hazards/garbage.jpg" class="card-img-top" alt="Garbage Dump">
                                <div class="image-overlay"></div>
                                <span class="hazard-status status-pending" data-translate="pending">Pending</span>
                                <span class="hazard-type type-other" data-translate="other">Other</span>
                                <span class="hazard-priority priority-low">Low Priority</span>
                                <div class="card-img-overlay">
                                    <span class="location-badge">
                                        <i class="fas fa-map-marker-alt"></i> Whitefield, Bengaluru
                                    </span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="hazard-meta">
                                    <div class="hazard-user">
                                        <div class="avatar-circle bg-info text-white">MR</div>
                                        <div>
                                            <div class="hazard-user-name">Meera Rao</div>
                                            <div class="hazard-date">Reported on May 8, 2023</div>
                                        </div>
                                    </div>
                                </div>
                                <h5 class="card-title">Garbage Dump on Street Corner</h5>
                                <p class="card-text">Accumulation of garbage causing foul smell and health hazards. Attracting stray animals and insects.</p>
                                
                                <div class="hazard-stats">
                                    <div class="stat-item">
                                        <i class="fas fa-eye"></i> 98 views
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-comment"></i> 7 comments
                                    </div>
                                </div>
                                
                                <div class="hazard-footer">
                                    <button class="upvote-btn">
                                        <i class="fas fa-arrow-up"></i> 15 Upvotes
                                    </button>
                                    <div class="hazard-actions">
                                        <button class="action-btn">
                                            <i class="fas fa-comment"></i> Comment
                                        </button>
                                        <button class="action-btn">
                                            <i class="fas fa-share-alt"></i> Share
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Pagination -->
                <div class="pagination-container">
                    <nav aria-label="Hazards pagination">
                        <ul class="pagination">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Voice Report Modal -->
<div class="modal fade voice-report-modal" id="voiceReportModal" tabindex="-1" aria-labelledby="voiceReportModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="voiceReportModalLabel" data-translate="voice-report">Voice Report</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted mb-4" data-translate="voice-report-desc">Describe the hazard using your voice. Speak clearly and include the location and type of hazard.</p>
                
                <div class="voice-visualizer mb-4">
                    <div class="voice-visualizer-bars" id="visualizer-bars"></div>
                </div>
                
                <div class="text-center mb-4">
                    <button class="btn btn-lg btn-outline-danger rounded-circle p-3" id="recordBtn">
                        <i class="fas fa-microphone fa-2x"></i>
                    </button>
                    <p class="text-muted mt-2" id="recordingStatus" data-translate="tap-to-record">Tap to start recording</p>
                </div>
                
                <div class="mb-3">
                    <label for="voiceTranscript" class="form-label" data-translate="transcript">Transcript</label>
                    <textarea class="form-control" id="voiceTranscript" rows="3" readonly></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-translate="cancel">Cancel</button>
                <button type="button" class="btn btn-primary" id="submitVoiceReport" disabled data-translate="submit-report">Submit Report</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Leaflet Map
        const bengaluru = [12.9716, 77.5946]; // Leaflet uses [lat, lng] format
        const map = L.map('hazards-map').setView(bengaluru, 12);
        
        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Define custom icons for different hazard types
        const redIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });
        
        const blueIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });
        
        const greenIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });
        
        const yellowIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });
        
        // Sample hazard locations
        const hazards = [
            {
                position: [12.9716, 77.5946],
                title: "Large Pothole on Main Road",
                type: "road",
                status: "pending",
                icon: redIcon
            },
            {
                position: [12.9352, 77.6245],
                title: "Water Pipeline Leakage",
                type: "water",
                status: "in-progress",
                icon: blueIcon
            },
            {
                position: [12.9784, 77.6408],
                title: "Fallen Power Line",
                type: "electricity",
                status: "resolved",
                icon: greenIcon
            },
            {
                position: [12.9698, 77.7499],
                title: "Garbage Dump on Street Corner",
                type: "other",
                status: "pending",
                icon: yellowIcon
            }
        ];
        
        // Add markers for each hazard
        hazards.forEach(hazard => {
            const marker = L.marker(hazard.position, {icon: hazard.icon}).addTo(map);
            
            // Add popup for each marker
            marker.bindPopup(`
                <div style="max-width: 200px;">
                    <h6 style="margin-bottom: 5px;">${hazard.title}</h6>
                    <p style="margin-bottom: 5px; font-size: 0.9rem;">Type: ${hazard.type.charAt(0).toUpperCase() + hazard.type.slice(1)}</p>
                    <p style="margin-bottom: 0; font-size: 0.9rem;">Status: ${hazard.status.charAt(0).toUpperCase() + hazard.status.slice(1)}</p>
                </div>
            `);
        });
    });
    
    document.addEventListener("DOMContentLoaded", function() {
        // Voice Report Button
        const voiceReportBtn = document.getElementById("voiceReportBtn");
        const voiceReportModal = new bootstrap.Modal(document.getElementById("voiceReportModal"));
        
        voiceReportBtn.addEventListener("click", function() {
            voiceReportModal.show();
            initializeVisualizer();
        });
        
        // Record Button
        const recordBtn = document.getElementById("recordBtn");
        const recordingStatus = document.getElementById("recordingStatus");
        const voiceTranscript = document.getElementById("voiceTranscript");
        const submitVoiceReport = document.getElementById("submitVoiceReport");
        let isRecording = false;
        
        recordBtn.addEventListener("click", function() {
            if (!isRecording) {
                // Start recording
                isRecording = true;
                recordBtn.classList.add("btn-danger");
                recordBtn.classList.remove("btn-outline-danger");
                voiceReportBtn.classList.add("recording");
                recordingStatus.textContent = "Recording... Click to stop";
                
                // Simulate recording with visualizer
                startVisualizer();
                
                // Simulate speech recognition after 5 seconds
                setTimeout(() => {
                    if (isRecording) {
                        stopRecording();
                        voiceTranscript.value = "There is a large pothole on Main Road near the junction in Jayanagar. It's causing traffic and is dangerous for two-wheelers.";
                        submitVoiceReport.disabled = false;
                    }
                }, 5000);
            } else {
                // Stop recording
                stopRecording();
            }
        });
        
        function stopRecording() {
            isRecording = false;
            recordBtn.classList.remove("btn-danger");
            recordBtn.classList.add("btn-outline-danger");
            voiceReportBtn.classList.remove("recording");
            recordingStatus.textContent = "Tap to start recording";
            stopVisualizer();
        }
        
        // Submit Voice Report
        submitVoiceReport.addEventListener("click", function() {
            // Show success message
            showToast("Hazard report submitted successfully!", "success");
            voiceReportModal.hide();
            
            // Reset form
            voiceTranscript.value = "";
            submitVoiceReport.disabled = true;
        });
        
        // Visualizer
        let visualizerInterval;
        const visualizerBars = document.getElementById("visualizer-bars");
        
        function initializeVisualizer() {
            // Create bars
            visualizerBars.innerHTML = "";
            for (let i = 0; i < 30; i++) {
                const bar = document.createElement("div");
                bar.className = "visualizer-bar";
                bar.style.height = "5px";
                visualizerBars.appendChild(bar);
            }
        }
        
        function startVisualizer() {
            visualizerInterval = setInterval(() => {
                const bars = visualizerBars.querySelectorAll(".visualizer-bar");
                bars.forEach(bar => {
                    const height = Math.floor(Math.random() * 80) + 5;
                    bar.style.height = `${height}px`;
                });
            }, 100);
        }
        
        function stopVisualizer() {
            clearInterval(visualizerInterval);
            const bars = visualizerBars.querySelectorAll(".visualizer-bar");
            bars.forEach(bar => {
                bar.style.height = "5px";
            });
        }
        
        // Language Toggle
        const languageBtns = document.querySelectorAll(".language-btn");
        
        languageBtns.forEach(btn => {
            btn.addEventListener("click", function() {
                languageBtns.forEach(b => b.classList.remove("active"));
                this.classList.add("active");
                
                const lang = this.dataset.lang;
                // In a real app, this would change the language
                showToast(`Language changed to ${lang.toUpperCase()}`, "info");
            });
        });
        
        // Upvote Buttons
        const upvoteBtns = document.querySelectorAll(".upvote-btn");
        
        upvoteBtns.forEach(btn => {
            btn.addEventListener("click", function() {
                this.classList.toggle("active");
                const currentText = this.textContent.trim();
                const upvotes = parseInt(currentText.match(/\d+/)[0]);
                
                if (this.classList.contains("active")) {
                    this.innerHTML = `<i class="fas fa-arrow-up"></i> ${upvotes + 1} Upvotes`;
                } else {
                    this.innerHTML = `<i class="fas fa-arrow-up"></i> ${upvotes - 1} Upvotes`;
                }
            });
        });
        
        // Filter Form
        const filterForm = document.getElementById("filter-form");
        
        filterForm.addEventListener("submit", function(e) {
            e.preventDefault();
            
            // Get filter values
            const type = document.getElementById("hazard-type").value;
            const status = document.getElementById("hazard-status").value;
            const priority = document.getElementById("hazard-priority").value;
            const location = document.getElementById("location-filter").value;
            const dateRange = document.getElementById("date-range").value;
            
            // In a real app, this would filter the hazards
            showToast("Filters applied", "success");
        });
        
        // Sort Dropdown
        const sortLinks = document.querySelectorAll("[data-sort]");
        
        sortLinks.forEach(link => {
            link.addEventListener("click", function(e) {
                e.preventDefault();
                
                // Remove active class from all links
                sortLinks.forEach(l => l.classList.remove("active"));
                
                // Add active class to clicked link
                this.classList.add("active");
                
                // Get sort value
                const sort = this.dataset.sort;
                
                // Update dropdown text
                document.getElementById("sortDropdown").innerHTML = `<i class="fas fa-sort me-1"></i> ${this.textContent}`;
                
                // In a real app, this would sort the hazards
                showToast(`Sorted by ${this.textContent}`, "info");
            });
        });
        
        // Helper function to show toast
        function showToast(message, type = "info") {
            // Check if showToast function exists in global scope (from base template)
            if (typeof window.showToast === "function") {
                window.showToast(message, type);
            } else {
                // Fallback
                alert(message);
            }
        }
    });
</script>
{% endblock %}