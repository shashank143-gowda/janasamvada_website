{% extends 'base.html' %}

{% block title %}Government Schemes - JanSamvaad{% endblock %}

{% block extra_css %}
<style>
    .schemes-header {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        padding: 60px 0;
        border-radius: 0 0 50px 50px;
        margin-bottom: 40px;
    }
    
    .search-container {
        background-color: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        margin-top: -30px;
        position: relative;
        z-index: 10;
    }
    
    .scheme-card {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        height: 100%;
        border: none;
    }
    
    .scheme-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }
    
    .scheme-card .card-header {
        background: linear-gradient(to right, #f8f9fa, #e9ecef);
        border-bottom: none;
        padding: 20px;
    }
    
    .scheme-card .card-body {
        padding: 20px;
    }
    
    .scheme-card .card-footer {
        background-color: transparent;
        border-top: 1px solid #f1f1f1;
        padding: 15px 20px;
    }
    
    .category-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        margin-right: 15px;
    }
    
    .agriculture {
        background-color: #2ecc71;
    }
    
    .education {
        background-color: #3498db;
    }
    
    .health {
        background-color: #e74c3c;
    }
    
    .housing {
        background-color: #9b59b6;
    }
    
    .women {
        background-color: #e84393;
    }
    
    .employment {
        background-color: #f39c12;
    }
    
    .senior-citizens {
        background-color: #7f8c8d;
    }
    
    .energy {
        background-color: #f1c40f;
    }
    
    .filter-btn {
        border-radius: 30px;
        padding: 8px 20px;
        margin: 5px;
        transition: all 0.3s ease;
    }
    
    .filter-btn:hover, .filter-btn.active {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .scheme-details-container {
        padding: 30px;
    }
    
    .scheme-detail-section {
        margin-bottom: 30px;
    }
    
    .scheme-detail-section h5 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-weight: 600;
    }
    
    .scheme-step {
        margin-bottom: 10px;
        position: relative;
        padding-left: 30px;
    }
    
    .scheme-step:before {
        content: '';
        position: absolute;
        left: 0;
        top: 8px;
        width: 20px;
        height: 20px;
        background-color: #2ecc71;
        border-radius: 50%;
    }
    
    .scheme-step:after {
        content: '';
        position: absolute;
        left: 9px;
        top: 28px;
        width: 2px;
        height: calc(100% - 10px);
        background-color: #2ecc71;
    }
    
    .scheme-step:last-child:after {
        display: none;
    }
    
    .document-item {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
    }
    
    .document-item i {
        font-size: 1.5rem;
        color: #3498db;
        margin-right: 15px;
    }
    
    .scheme-contact {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
    }
    
    .scheme-contact-item {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .scheme-contact-item i {
        font-size: 1.2rem;
        color: #2ecc71;
        margin-right: 15px;
        width: 20px;
        text-align: center;
    }
    
    .scheme-eligibility-tag {
        display: inline-block;
        background-color: #e8f5e9;
        color: #2e7d32;
        border-radius: 30px;
        padding: 5px 15px;
        margin-right: 10px;
        margin-bottom: 10px;
        font-size: 0.9rem;
    }
    
    .scheme-benefit-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
    }
    
    .scheme-benefit-item i {
        color: #2ecc71;
        margin-right: 15px;
        margin-top: 3px;
    }
    
    .scheme-category-badge {
        position: absolute;
        top: 20px;
        right: 20px;
        padding: 8px 15px;
        border-radius: 30px;
        font-size: 0.8rem;
        font-weight: 600;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .scheme-search-input {
        border-radius: 30px;
        padding-left: 20px;
        padding-right: 20px;
        border: 2px solid #e9ecef;
        box-shadow: none;
        transition: all 0.3s ease;
    }
    
    .scheme-search-input:focus {
        border-color: #2ecc71;
        box-shadow: 0 0 0 0.25rem rgba(46, 204, 113, 0.25);
    }
    
    .scheme-search-btn {
        border-radius: 30px;
        padding-left: 25px;
        padding-right: 25px;
    }
    
    .category-list-item {
        border-radius: 10px;
        margin-bottom: 8px;
        transition: all 0.3s ease;
        border: none;
        background-color: #f8f9fa;
    }
    
    .category-list-item:hover, .category-list-item.active {
        background-color: #e8f5e9;
        color: #2e7d32;
        transform: translateX(5px);
    }
    
    .category-list-item.active {
        font-weight: 600;
    }
    
    .scheme-count-badge {
        background-color: #2ecc71;
        color: white;
        font-weight: 600;
        padding: 5px 15px;
        border-radius: 30px;
    }
    
    .scheme-modal-header {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
        border-radius: 10px 10px 0 0;
    }
    
    .scheme-modal-content {
        border: none;
        border-radius: 10px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    }
    
    .scheme-website-btn {
        border-radius: 30px;
        padding-left: 25px;
        padding-right: 25px;
    }
    
    .scheme-close-btn {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .scheme-close-btn:hover {
        background-color: rgba(255, 255, 255, 0.5);
        transform: rotate(90deg);
    }
    
    .schemes-empty {
        text-align: center;
        padding: 50px 0;
    }
    
    .schemes-empty i {
        font-size: 5rem;
        color: #e9ecef;
        margin-bottom: 20px;
    }
    
    .schemes-empty p {
        color: #6c757d;
        font-size: 1.2rem;
    }
    
    /* Animation classes */
    .fade-in {
        animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
{% endblock %}

{% block content %}
<!-- Header Section -->
<section class="schemes-header">
    <div class="container text-center">
        <h1 class="display-4 fw-bold mb-4 animate__animated animate__fadeInDown">Government Schemes</h1>
        <p class="lead mb-0 animate__animated animate__fadeInUp">Access information about government schemes for health, agriculture, women, and more with eligibility details.</p>
    </div>
</section>

<!-- Search Section -->
<section class="container mb-5">
    <div class="search-container" data-aos="fade-up">
        <div class="row">
            <div class="col-md-8 mb-3">
                <div class="input-group">
                    <input type="text" id="scheme-search" class="form-control scheme-search-input" placeholder="Search schemes by name, description, or eligibility...">
                    <button class="btn btn-success scheme-search-btn" type="button" id="search-btn">
                        <i class="fas fa-search me-2"></i> Search
                    </button>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <select class="form-select scheme-search-input" id="scheme-filter">
                    <option value="all" selected>All Categories</option>
                    <option value="agriculture">Agriculture</option>
                    <option value="education">Education</option>
                    <option value="health">Health</option>
                    <option value="housing">Housing</option>
                    <option value="women">Women & Child</option>
                    <option value="employment">Employment</option>
                    <option value="senior-citizens">Senior Citizens</option>
                    <option value="energy">Energy</option>
                </select>
            </div>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="filter-buttons">
                <button class="btn btn-sm filter-btn active" data-filter="all">All</button>
                <button class="btn btn-sm filter-btn btn-outline-success" data-filter="agriculture">Agriculture</button>
                <button class="btn btn-sm filter-btn btn-outline-primary" data-filter="education">Education</button>
                <button class="btn btn-sm filter-btn btn-outline-danger" data-filter="health">Health</button>
                <button class="btn btn-sm filter-btn btn-outline-purple" data-filter="women">Women & Child</button>
                <button class="btn btn-sm filter-btn btn-outline-warning" data-filter="employment">Employment</button>
            </div>
            <span id="schemes-count" class="scheme-count-badge">0 schemes</span>
        </div>
    </div>
</section>

<!-- Schemes Section -->
<section class="container mb-5">
    <div class="row">
        <!-- Categories Sidebar -->
        <div class="col-lg-3 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Categories</h5>
                </div>
                <div class="card-body p-3">
                    <div class="list-group" id="category-list">
                        <button type="button" class="list-group-item list-group-item-action category-list-item active" data-category="all">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>All Categories</span>
                                <span class="badge bg-success rounded-pill">0</span>
                            </div>
                        </button>
                        <button type="button" class="list-group-item list-group-item-action category-list-item" data-category="agriculture">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Agriculture</span>
                                <span class="badge bg-success rounded-pill">0</span>
                            </div>
                        </button>
                        <button type="button" class="list-group-item list-group-item-action category-list-item" data-category="education">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Education</span>
                                <span class="badge bg-success rounded-pill">0</span>
                            </div>
                        </button>
                        <button type="button" class="list-group-item list-group-item-action category-list-item" data-category="health">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Health</span>
                                <span class="badge bg-success rounded-pill">0</span>
                            </div>
                        </button>
                        <button type="button" class="list-group-item list-group-item-action category-list-item" data-category="housing">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Housing</span>
                                <span class="badge bg-success rounded-pill">0</span>
                            </div>
                        </button>
                        <button type="button" class="list-group-item list-group-item-action category-list-item" data-category="women">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Women & Child</span>
                                <span class="badge bg-success rounded-pill">0</span>
                            </div>
                        </button>
                        <button type="button" class="list-group-item list-group-item-action category-list-item" data-category="employment">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Employment</span>
                                <span class="badge bg-success rounded-pill">0</span>
                            </div>
                        </button>
                        <button type="button" class="list-group-item list-group-item-action category-list-item" data-category="senior-citizens">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Senior Citizens</span>
                                <span class="badge bg-success rounded-pill">0</span>
                            </div>
                        </button>
                        <button type="button" class="list-group-item list-group-item-action category-list-item" data-category="energy">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Energy</span>
                                <span class="badge bg-success rounded-pill">0</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Popular Schemes -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Popular Schemes</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush" id="popular-schemes">
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center p-3" onclick="viewSchemeDetails(1)">
                            <div class="flex-shrink-0">
                                <div class="category-icon agriculture" style="width: 40px; height: 40px; font-size: 1rem;">
                                    <i class="fas fa-tractor"></i>
                                </div>
                            </div>
                            <div class="ms-3">
                                <h6 class="mb-0">PM Kisan Samman Nidhi</h6>
                                <small class="text-muted">Agriculture</small>
                            </div>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center p-3" onclick="viewSchemeDetails(2)">
                            <div class="flex-shrink-0">
                                <div class="category-icon education" style="width: 40px; height: 40px; font-size: 1rem;">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                            </div>
                            <div class="ms-3">
                                <h6 class="mb-0">PM Vidya Lakshmi</h6>
                                <small class="text-muted">Education</small>
                            </div>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center p-3" onclick="viewSchemeDetails(3)">
                            <div class="flex-shrink-0">
                                <div class="category-icon health" style="width: 40px; height: 40px; font-size: 1rem;">
                                    <i class="fas fa-heartbeat"></i>
                                </div>
                            </div>
                            <div class="ms-3">
                                <h6 class="mb-0">Ayushman Bharat</h6>
                                <small class="text-muted">Health</small>
                            </div>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center p-3" onclick="viewSchemeDetails(4)">
                            <div class="flex-shrink-0">
                                <div class="category-icon women" style="width: 40px; height: 40px; font-size: 1rem;">
                                    <i class="fas fa-female"></i>
                                </div>
                            </div>
                            <div class="ms-3">
                                <h6 class="mb-0">Beti Bachao Beti Padhao</h6>
                                <small class="text-muted">Women & Child</small>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Schemes List -->
        <div class="col-lg-9">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0" id="schemes-title">All Schemes</h5>
                </div>
                <div class="card-body">
                    <div id="schemes-list" class="row">
                        <div class="text-center py-4">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading schemes...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Scheme Details Modal -->
<div class="modal fade" id="schemeModal" tabindex="-1" aria-labelledby="schemeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content scheme-modal-content">
            <div class="modal-header scheme-modal-header">
                <h5 class="modal-title" id="schemeModalLabel">Scheme Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0" id="scheme-details">
                <div class="text-center py-4">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Loading scheme details...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a href="#" id="scheme-website" class="btn btn-success scheme-website-btn" target="_blank">
                    <i class="fas fa-external-link-alt me-2"></i> Visit Official Website
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Include Chatbot Component -->
{% include 'components/chatbot.html' %}
{% endblock %}

{% block extra_js %}
<script>
    let allSchemes = [];
    let currentCategory = 'all';
    let schemeModal;
    let categoryCount = {};
    
    $(document).ready(function() {
        // Initialize modal
        schemeModal = new bootstrap.Modal(document.getElementById('schemeModal'));
        
        // Load all schemes
        loadSchemes();
        
        // Category filter
        $(document).on('click', '.category-list-item', function() {
            $('.category-list-item').removeClass('active');
            $(this).addClass('active');
            currentCategory = $(this).data('category');
            
            if (currentCategory === 'all') {
                $('#schemes-title').text('All Schemes');
                filterSchemes();
            } else {
                $('#schemes-title').text(currentCategory.charAt(0).toUpperCase() + currentCategory.slice(1) + ' Schemes');
                filterSchemes(currentCategory);
            }
        });
        
        // Filter buttons
        $(document).on('click', '.filter-btn', function() {
            $('.filter-btn').removeClass('active');
            $(this).addClass('active');
            const category = $(this).data('filter');
            
            // Also update the sidebar selection
            $('.category-list-item').removeClass('active');
            $(`.category-list-item[data-category="${category}"]`).addClass('active');
            
            currentCategory = category;
            
            if (category === 'all') {
                $('#schemes-title').text('All Schemes');
                filterSchemes();
            } else {
                $('#schemes-title').text(category.charAt(0).toUpperCase() + category.slice(1) + ' Schemes');
                filterSchemes(category);
            }
        });
        
        // Dropdown filter
        $('#scheme-filter').change(function() {
            const category = $(this).val();
            
            // Update other UI elements
            $('.filter-btn').removeClass('active');
            $(`.filter-btn[data-filter="${category}"]`).addClass('active');
            $('.category-list-item').removeClass('active');
            $(`.category-list-item[data-category="${category}"]`).addClass('active');
            
            currentCategory = category;
            
            if (category === 'all') {
                $('#schemes-title').text('All Schemes');
                filterSchemes();
            } else {
                $('#schemes-title').text(category.charAt(0).toUpperCase() + category.slice(1) + ' Schemes');
                filterSchemes(category);
            }
        });
        
        // Search functionality
        $('#search-btn').click(function() {
            const searchTerm = $('#scheme-search').val().toLowerCase();
            filterSchemes(currentCategory, searchTerm);
        });
        
        $('#scheme-search').on('keyup', function(e) {
            if (e.key === 'Enter') {
                const searchTerm = $(this).val().toLowerCase();
                filterSchemes(currentCategory, searchTerm);
            }
        });
    });
    
    function loadSchemes() {
        $.ajax({
            url: '/schemes/api/schemes',
            method: 'GET',
            success: function(response) {
                if (response.success) {
                    allSchemes = response.schemes;
                    
                    // Count schemes by category
                    countSchemesByCategory();
                    
                    // Update category counts in sidebar
                    updateCategoryCounts();
                    
                    // Display all schemes
                    displaySchemes(allSchemes);
                } else {
                    $('#schemes-list').html('<div class="col-12"><div class="alert alert-danger">Failed to load schemes</div></div>');
                }
            },
            error: function() {
                $('#schemes-list').html('<div class="col-12"><div class="alert alert-danger">Failed to load schemes. Please try again.</div></div>');
            }
        });
    }
    
    function countSchemesByCategory() {
        // Initialize counts
        categoryCount = {
            all: allSchemes.length,
            agriculture: 0,
            education: 0,
            health: 0,
            housing: 0,
            women: 0,
            employment: 0,
            'senior-citizens': 0,
            energy: 0
        };
        
        // Count schemes by category
        allSchemes.forEach(scheme => {
            const category = scheme.category.toLowerCase();
            if (categoryCount.hasOwnProperty(category)) {
                categoryCount[category]++;
            }
        });
    }
    
    function updateCategoryCounts() {
        // Update count in sidebar
        for (const category in categoryCount) {
            $(`.category-list-item[data-category="${category}"] .badge`).text(categoryCount[category]);
        }
        
        // Update total count
        $('#schemes-count').text(`${categoryCount.all} schemes`);
    }
    
    function filterSchemes(category = 'all', searchTerm = '') {
        let filteredSchemes = allSchemes;
        
        // Filter by category
        if (category !== 'all') {
            filteredSchemes = filteredSchemes.filter(scheme => scheme.category.toLowerCase() === category);
        }
        
        // Filter by search term
        if (searchTerm) {
            filteredSchemes = filteredSchemes.filter(scheme => 
                scheme.name.toLowerCase().includes(searchTerm) || 
                scheme.description.toLowerCase().includes(searchTerm) ||
                scheme.eligibility.toLowerCase().includes(searchTerm)
            );
        }
        
        displaySchemes(filteredSchemes);
    }
    
    function displaySchemes(schemes) {
        // Update count
        $('#schemes-count').text(`${schemes.length} schemes`);
        
        if (schemes.length === 0) {
            $('#schemes-list').html(`
                <div class="col-12 schemes-empty">
                    <i class="fas fa-search"></i>
                    <p>No schemes found matching your criteria.</p>
                    <button class="btn btn-outline-success mt-3" onclick="resetFilters()">
                        <i class="fas fa-sync-alt me-2"></i> Reset Filters
                    </button>
                </div>
            `);
            return;
        }
        
        let html = '';
        
        schemes.forEach(function(scheme) {
            // Get appropriate icon based on category
            let categoryIcon, categoryClass;
            
            switch(scheme.category.toLowerCase()) {
                case 'agriculture':
                    categoryIcon = '<i class="fas fa-tractor"></i>';
                    categoryClass = 'agriculture';
                    break;
                case 'health':
                    categoryIcon = '<i class="fas fa-heartbeat"></i>';
                    categoryClass = 'health';
                    break;
                case 'education':
                    categoryIcon = '<i class="fas fa-graduation-cap"></i>';
                    categoryClass = 'education';
                    break;
                case 'women':
                    categoryIcon = '<i class="fas fa-female"></i>';
                    categoryClass = 'women';
                    break;
                case 'housing':
                    categoryIcon = '<i class="fas fa-home"></i>';
                    categoryClass = 'housing';
                    break;
                case 'energy':
                    categoryIcon = '<i class="fas fa-bolt"></i>';
                    categoryClass = 'energy';
                    break;
                case 'employment':
                    categoryIcon = '<i class="fas fa-briefcase"></i>';
                    categoryClass = 'employment';
                    break;
                case 'senior-citizens':
                    categoryIcon = '<i class="fas fa-user-friends"></i>';
                    categoryClass = 'senior-citizens';
                    break;
                default:
                    categoryIcon = '<i class="fas fa-file-alt"></i>';
                    categoryClass = '';
            }
            
            html += `
                <div class="col-md-6 mb-4 fade-in">
                    <div class="card scheme-card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">${scheme.name}</h5>
                            </div>
                            <span class="badge bg-success scheme-category-badge">${scheme.category}</span>
                        </div>
                        <div class="card-body">
                            <div class="d-flex mb-3">
                                <div class="category-icon ${categoryClass}">
                                    ${categoryIcon}
                                </div>
                                <div>
                                    <p class="card-text">${truncateText(scheme.description, 120)}</p>
                                </div>
                            </div>
                            <p><strong>Eligibility:</strong> ${truncateText(scheme.eligibility, 80)}</p>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary" onclick="viewSchemeDetails(${scheme.id})">
                                <i class="fas fa-info-circle me-2"></i> View Details
                            </button>
                            ${scheme.website ? `<a href="${scheme.website}" target="_blank" class="btn btn-outline-success float-end">
                                <i class="fas fa-external-link-alt me-1"></i> Official Site
                            </a>` : ''}
                        </div>
                    </div>
                </div>
            `;
        });
        
        $('#schemes-list').html(html);
    }
    
    function viewSchemeDetails(schemeId) {
        // Show loading in modal
        $('#scheme-details').html(`
            <div class="text-center py-4">
                <div class="spinner-border text-success" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading scheme details...</p>
            </div>
        `);
        
        // Show modal
        schemeModal.show();
        
        // Fetch scheme details
        $.ajax({
            url: `/schemes/api/schemes/${schemeId}`,
            method: 'GET',
            success: function(response) {
                if (response.success) {
                    const scheme = response.scheme;
                    
                    // Update modal title
                    $('#schemeModalLabel').text(scheme.name);
                    
                    // Update website button
                    if (scheme.website) {
                        $('#scheme-website').attr('href', scheme.website).show();
                    } else {
                        $('#scheme-website').hide();
                    }
                    
                    // Get appropriate icon based on category
                    let categoryIcon, categoryClass;
                    
                    switch(scheme.category.toLowerCase()) {
                        case 'agriculture':
                            categoryIcon = '<i class="fas fa-tractor"></i>';
                            categoryClass = 'agriculture';
                            break;
                        case 'health':
                            categoryIcon = '<i class="fas fa-heartbeat"></i>';
                            categoryClass = 'health';
                            break;
                        case 'education':
                            categoryIcon = '<i class="fas fa-graduation-cap"></i>';
                            categoryClass = 'education';
                            break;
                        case 'women':
                            categoryIcon = '<i class="fas fa-female"></i>';
                            categoryClass = 'women';
                            break;
                        case 'housing':
                            categoryIcon = '<i class="fas fa-home"></i>';
                            categoryClass = 'housing';
                            break;
                        case 'energy':
                            categoryIcon = '<i class="fas fa-bolt"></i>';
                            categoryClass = 'energy';
                            break;
                        case 'employment':
                            categoryIcon = '<i class="fas fa-briefcase"></i>';
                            categoryClass = 'employment';
                            break;
                        case 'senior-citizens':
                            categoryIcon = '<i class="fas fa-user-friends"></i>';
                            categoryClass = 'senior-citizens';
                            break;
                        default:
                            categoryIcon = '<i class="fas fa-file-alt"></i>';
                            categoryClass = '';
                    }
                    
                    // Format application process as steps
                    const steps = scheme.application_process.split('\n').map(step => {
                        return `<li class="scheme-step">${step}</li>`;
                    }).join('');
                    
                    // Format documents required as list
                    const documents = scheme.documents_required.split('\n').map(doc => {
                        return `
                            <div class="document-item">
                                <i class="fas fa-file-alt"></i>
                                <div>${doc}</div>
                            </div>
                        `;
                    }).join('');
                    
                    // Format benefits as list
                    const benefits = scheme.benefits.split('\n').map(benefit => {
                        return `
                            <div class="scheme-benefit-item">
                                <i class="fas fa-check-circle"></i>
                                <div>${benefit}</div>
                            </div>
                        `;
                    }).join('');
                    
                    // Format eligibility as tags
                    const eligibilityTags = scheme.eligibility.split('\n').map(eligibility => {
                        return `<span class="scheme-eligibility-tag">${eligibility}</span>`;
                    }).join('');
                    
                    // Display scheme details
                    let html = `
                        <div class="scheme-details-container">
                            <div class="d-flex align-items-center mb-4">
                                <div class="category-icon ${categoryClass} me-3">
                                    ${categoryIcon}
                                </div>
                                <div>
                                    <h4 class="mb-1">${scheme.name}</h4>
                                    <span class="badge bg-success">${scheme.category}</span>
                                </div>
                            </div>
                            
                            <div class="scheme-detail-section">
                                <h5>Description</h5>
                                <p>${scheme.description}</p>
                            </div>
                            
                            <div class="scheme-detail-section">
                                <h5>Eligibility</h5>
                                <div class="mb-3">
                                    ${eligibilityTags}
                                </div>
                                <p>${scheme.eligibility}</p>
                            </div>
                            
                            <div class="scheme-detail-section">
                                <h5>Benefits</h5>
                                <div class="benefits-list">
                                    ${benefits}
                                </div>
                            </div>
                            
                            <div class="scheme-detail-section">
                                <h5>How to Apply</h5>
                                <ol class="application-steps">
                                    ${steps}
                                </ol>
                            </div>
                            
                            <div class="scheme-detail-section">
                                <h5>Documents Required</h5>
                                <div class="documents-list">
                                    ${documents}
                                </div>
                            </div>
                            
                            <div class="scheme-detail-section">
                                <h5>Contact Information</h5>
                                <div class="scheme-contact">
                                    <div class="scheme-contact-item">
                                        <i class="fas fa-phone"></i>
                                        <div>${scheme.contact_phone || 'Not available'}</div>
                                    </div>
                                    <div class="scheme-contact-item">
                                        <i class="fas fa-envelope"></i>
                                        <div>${scheme.contact_email || 'Not available'}</div>
                                    </div>
                                    <div class="scheme-contact-item">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <div>${scheme.contact_address || 'Not available'}</div>
                                    </div>
                                    <div class="scheme-contact-item">
                                        <i class="fas fa-globe"></i>
                                        <div>${scheme.website ? `<a href="${scheme.website}" target="_blank">${scheme.website}</a>` : 'Not available'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    $('#scheme-details').html(html);
                } else {
                    $('#scheme-details').html('<div class="alert alert-danger m-3">Failed to load scheme details</div>');
                }
            },
            error: function() {
                $('#scheme-details').html('<div class="alert alert-danger m-3">Failed to load scheme details. Please try again.</div>');
            }
        });
    }
    
    function resetFilters() {
        // Reset search input
        $('#scheme-search').val('');
        
        // Reset category filter
        $('#scheme-filter').val('all');
        
        // Reset UI elements
        $('.filter-btn').removeClass('active');
        $('.filter-btn[data-filter="all"]').addClass('active');
        $('.category-list-item').removeClass('active');
        $('.category-list-item[data-category="all"]').addClass('active');
        
        // Reset current category
        currentCategory = 'all';
        $('#schemes-title').text('All Schemes');
        
        // Display all schemes
        displaySchemes(allSchemes);
    }
    
    function truncateText(text, maxLength) {
        if (text.length <= maxLength) {
            return text;
        }
        return text.substring(0, maxLength) + '...';
    }
</script>
{% endblock %}